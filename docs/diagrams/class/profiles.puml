@startuml
title Profiles Bounded Context
top to bottom direction
skinparam packageStyle Rectangle
skinparam linetype ortho
skinparam classAttributeIconSize 0
scale 1400 height

package "interfaces" {
  package "rest" {
    class BusinessProfilesController {
      +createBusinessProfile(resource: CreateBusinessProfileResource): ResponseEntity<BusinessProfileResource>
      +getBusinessProfileById(id: Long): ResponseEntity<BusinessProfileResource>
      +getAllBusinessProfiles(): ResponseEntity<List<BusinessProfileResource>>
    }

    class PersonProfilesController {
      +createPersonProfile(resource: CreatePersonProfileResource): ResponseEntity<PersonProfileResource>
      +updatePersonProfile(id: Long, resource: UpdatePersonProfileResource): ResponseEntity<PersonProfileResource>
      +deletePersonProfile(id: Long): ResponseEntity<Void>
      +getPersonProfileById(id: Long): ResponseEntity<PersonProfileResource>
      +getPersonProfileByDni(dni: String): ResponseEntity<PersonProfileResource>
      +getAllPersonProfiles(): ResponseEntity<List<PersonProfileResource>>
    }

    package "resources" {
      class BusinessProfileResource {
        +id: Long
        +businessName: String
        +ruc: String
        +streetAddress: String
        +email: String
        +phoneNumber: String
      }

      class PersonProfileResource {
        +id: Long
        +fullName: String
        +dni: String
        +birthDate: String
        +age: Integer
        +photo: String
        +phoneNumber: String
        +emailAddress: String
        +streetAddress: String
      }

      class CreateBusinessProfileResource {
        +businessName: String
        +ruc: String
        +streetAddress: String
        +email: String
        +phoneNumber: String
      }

      class CreatePersonProfileResource {
        +personName: String
        +dni: String
        +birthDate: String
        +photo: String
        +phoneNumber: String
        +emailAddress: String
        +streetAddress: String
      }

      class UpdatePersonProfileResource {
        +personName: String
        +birthDate: String
        +photo: String
        +phoneNumber: String
        +emailAddress: String
        +streetAddress: String
      }
    }

    package "transform" {
      class BusinessProfileResourceFromEntityAssembler {
        +toResourceFromEntity(entity: BusinessProfile): BusinessProfileResource {static}
      }
      class PersonProfileResourceFromEntityAssembler {
        +toResourceFromEntity(entity: PersonProfile): PersonProfileResource {static}
      }
      class CreateBusinessProfileCommandFromResourceAssembler {
        +toCommandFromResource(r: CreateBusinessProfileResource): CreateBusinessProfileCommand {static}
      }
      class CreatePersonProfileCommandFromResourceAssembler {
        +toCommandFromResource(r: CreatePersonProfileResource): CreatePersonProfileCommand {static}
      }
      class UpdatePersonProfileCommandFromResourceAssembler {
        +toCommandFromResource(id: Long, r: UpdatePersonProfileResource): UpdatePersonProfileCommand {static}
      }
    }
  }

  package "acl" {
    class ProfilesContextFacade {
      +createPersonProfile(personName:String,dni:String,birthDate:String,photo:String,phone:String,email:String,street:String): Long
      +createBusinessProfile(businessName:String,ruc:String,street:String,email:String,phone:String): Long
      +fetchPersonProfileIdByDni(dni:String): Long
    }
    class ProfilesContextFacadeImpl {
      -personProfileCommandService: PersonProfileCommandService
      -personProfileQueryService: PersonProfileQueryService
      -businessProfileCommandService: BusinessProfileCommandService
      -businessProfileQueryService: BusinessProfileQueryService
      +createPersonProfile(...): Long
      +createBusinessProfile(...): Long
      +fetchPersonProfileIdByDni(dni:String): Long
    }
    ProfilesContextFacadeImpl ..|> ProfilesContextFacade
  }
}

package "application" {
  package "internal" {
    package "commandservices" {
      class PersonProfileCommandServiceImpl {
        +handle(CreatePersonProfileCommand): Optional<PersonProfile>
        +handle(UpdatePersonProfileCommand): Optional<PersonProfile>
        +handle(DeletePersonProfileCommand): void
      }
      class BusinessProfileCommandServiceImpl {
        +handle(CreateBusinessProfileCommand): Optional<BusinessProfile>
      }
    }
    package "queryservices" {
      class PersonProfileQueryServiceImpl {
        +handle(GetPersonProfileByIdQuery): Optional<PersonProfile>
        +handle(GetPersonProfileByDniQuery): Optional<PersonProfile>
        +handle(GetAllPersonProfileQuery): List<PersonProfile>
      }
      class BusinessProfileQueryServiceImpl {
        +handle(GetBusinessProfileByIdQuery): Optional<BusinessProfile>
        +handle(GetAllBusinessProfileQuery): List<BusinessProfile>
      }
    }
  }
}

package "domain" {
  package "model" {
    package "aggregates" {
      class Profile <<aggregate>> {
        -emailAddress: EmailAddress
        -streetAddress: StreetAddress
        +getEmailAddress(): String
        +getStreetAddress(): String
        +updateEmailAddress(email:String): void
      }
      class PersonProfile <<aggregate>> {
        -personName: PersonName
        -dni: Dni
        -birthDate: BirthDate
        -age: Age
        -photo: Photo
        -phoneNumber: PhoneNumber
        -emailAddress: EmailAddress
        -streetAddress: StreetAddress
        +update(...): void
        +getFullName(): String
      }
      class BusinessProfile <<aggregate>> {
        -businessName: BusinessName
        -ruc: Ruc
        -streetAddress: StreetAddress
        -emailAddress: EmailAddress
        -phoneNumber: PhoneNumber
        +update(...): void
      }
      Profile <|-- PersonProfile
      Profile <|-- BusinessProfile
    }

    package "entities" {
      class HeadQuarter {
        +id: Long
        +address: StreetAddress
      }
    }

    package "valueobjects" {
      class PersonName <<VO>>
      class BusinessName <<VO>>
      class EmailAddress <<VO>>
      class StreetAddress <<VO>>
      class Dni <<VO>>
      class Ruc <<VO>>
      class BirthDate <<VO>>
      class Age <<VO>>
      class Photo <<VO>>
      class PhoneNumber <<VO>>
    }

    package "commands" {
      class CreatePersonProfileCommand <<command>>
      class UpdatePersonProfileCommand <<command>>
      class DeletePersonProfileCommand <<command>>
      class CreateBusinessProfileCommand <<command>>
    }

    package "queries" {
      class GetPersonProfileByIdQuery <<query>>
      class GetPersonProfileByDniQuery <<query>>
      class GetAllPersonProfileQuery <<query>>
      class GetBusinessProfileByIdQuery <<query>>
      class GetAllBusinessProfileQuery <<query>>
    }
  }

  package "domain.services" {
    class PersonProfileCommandService <<port>> {
      +handle(CreatePersonProfileCommand): Optional<PersonProfile>
      +handle(UpdatePersonProfileCommand): Optional<PersonProfile>
      +handle(DeletePersonProfileCommand): void
    }
    class PersonProfileQueryService <<port>> {
      +handle(GetPersonProfileByIdQuery): Optional<PersonProfile>
      +handle(GetPersonProfileByDniQuery): Optional<PersonProfile>
      +handle(GetAllPersonProfileQuery): List<PersonProfile>
    }
    class BusinessProfileCommandService <<port>> {
      +handle(CreateBusinessProfileCommand): Optional<BusinessProfile>
    }
    class BusinessProfileQueryService <<port>> {
      +handle(GetBusinessProfileByIdQuery): Optional<BusinessProfile>
      +handle(GetAllBusinessProfileQuery): List<BusinessProfile>
    }
  }
}

package "infrastructure.persistence.jpa.repositories" {
  class PersonProfileRepository <<repository>>
  class BusinessProfileRepository <<repository>>
}

' Relaciones clave
BusinessProfilesController ..> CreateBusinessProfileCommandFromResourceAssembler
BusinessProfilesController ..> BusinessProfileResourceFromEntityAssembler
BusinessProfilesController ..> ProfilesContextFacade
PersonProfilesController ..> CreatePersonProfileCommandFromResourceAssembler
PersonProfilesController ..> UpdatePersonProfileCommandFromResourceAssembler
PersonProfilesController ..> PersonProfileResourceFromEntityAssembler
PersonProfilesController ..> ProfilesContextFacade

ProfilesContextFacadeImpl ..> PersonProfileCommandService
ProfilesContextFacadeImpl ..> PersonProfileQueryService
ProfilesContextFacadeImpl ..> BusinessProfileCommandService
ProfilesContextFacadeImpl ..> BusinessProfileQueryService

PersonProfileCommandServiceImpl ..|> PersonProfileCommandService
PersonProfileQueryServiceImpl ..|> PersonProfileQueryService
BusinessProfileCommandServiceImpl ..|> BusinessProfileCommandService
BusinessProfileQueryServiceImpl ..|> BusinessProfileQueryService

PersonProfileCommandServiceImpl ..> PersonProfileRepository
PersonProfileQueryServiceImpl ..> PersonProfileRepository
BusinessProfileCommandServiceImpl ..> BusinessProfileRepository
BusinessProfileQueryServiceImpl ..> BusinessProfileRepository
@enduml
